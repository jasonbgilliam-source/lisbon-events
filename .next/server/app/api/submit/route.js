"use strict";(()=>{var e={};e.id=499,e.ids=[499],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},6611:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>A,requestAsyncStorage:()=>S,routeModule:()=>d,serverHooks:()=>E,staticGenerationAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{POST:()=>m,dynamic:()=>p,revalidate:()=>c});var n=t(9303),i=t(8716),o=t(3131),a=t(7070),u=t(474);function l(e){if(!e)return null;let r=new Date(e);return Number.isNaN(r.getTime())?null:r.toISOString()}let p="force-dynamic",c=0;async function _(){let e=(0,u.R)(),{data:r,error:t}=await e.from("category_catalog").select("name");if(t)throw Error(t.message);return new Set((r||[]).map(e=>String(e.name)))}async function m(e){try{let r=await e.json();for(let e of["title","description","starts_at","location_name","organizer_email"])if(!r[e])return a.NextResponse.json({error:`Missing ${e}`},{status:400});let t=l(r.starts_at),s=l(r.ends_at),n=(r.category??"").toString().trim();if(!n)return a.NextResponse.json({error:"Category is required"},{status:400});if(!(await _()).has(n))return a.NextResponse.json({error:"Invalid category. Please select from the list."},{status:400});let i=(0,u.R)(),{error:o}=await i.from("event_submissions").insert([{title:r.title,description:r.description,starts_at:t,ends_at:s,location_name:r.location_name,address:r.address||null,ticket_url:r.ticket_url||null,image_url:r.image_url||null,organizer_email:r.organizer_email,age:r.age||null,city:r.city||null,all_day:"true"===String(r.all_day??"").trim().toLowerCase()||!0===r.all_day,category:n,youtube_url:r.youtube_url??null,spotify_url:r.spotify_url??null,status:"pending"}]);if(o)return a.NextResponse.json({error:o.message},{status:500});return a.NextResponse.json({ok:!0})}catch(e){return console.error("Error in /api/submit:",e),a.NextResponse.json({error:e?.message??"Unknown error"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/submit/route",pathname:"/api/submit",filename:"route",bundlePath:"app/api/submit/route"},resolvedPagePath:"/workspaces/lisbon-events/app/api/submit/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:S,staticGenerationAsyncStorage:g,serverHooks:E}=d,f="/api/submit/route";function A(){return(0,o.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:g})}},474:(e,r,t)=>{t.d(r,{R:()=>n});var s=t(1657);function n(){let e=process.env.NEXT_PUBLIC_SUPABASE_URL||process.env.SUPABASE_URL||"",r=process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.SUPABASE_SERVICE_KEY||process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"";if(!e||!r)throw Error("Supabase URL or KEY missing. Set NEXT_PUBLIC_SUPABASE_URL and either SUPABASE_SERVICE_ROLE_KEY or NEXT_PUBLIC_SUPABASE_ANON_KEY.");return(0,s.eI)(e,r,{auth:{persistSession:!1}})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,561,70],()=>t(6611));module.exports=s})();