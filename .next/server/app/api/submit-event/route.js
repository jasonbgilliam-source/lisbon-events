"use strict";(()=>{var e={};e.id=919,e.ids=[919],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},2544:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>S,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>E});var s={};r.r(s),r.d(s,{POST:()=>m,dynamic:()=>p,revalidate:()=>c});var n=r(9303),i=r(8716),o=r(3131),a=r(7070),u=r(474);function l(e){if(!e)return null;let t=new Date(e);return Number.isNaN(t.getTime())?null:t.toISOString()}let p="force-dynamic",c=0;async function _(){let e=(0,u.R)(),{data:t,error:r}=await e.from("category_catalog").select("name");if(r)throw Error(r.message);return new Set((t||[]).map(e=>String(e.name)))}async function m(e){try{let t=await e.json(),r=(t.title||"").trim(),s=(t.description||"").trim(),n=(t.location_name||"").trim(),i=(t.organizer_email||"").trim(),o=l(t.starts_at||t.start);if(!r||!s||!n||!i||!o)return a.NextResponse.json({error:"Missing required fields"},{status:400});let p=l(t.ends_at||t.end),c="true"===String(t.all_day??"").trim().toLowerCase()||!0===t.all_day,m=(t.category??"").toString().trim();if(!m)return a.NextResponse.json({error:"Category is required"},{status:400});if(!(await _()).has(m))return a.NextResponse.json({error:"Invalid category. Please select from the list."},{status:400});let{error:d}=await (0,u.R)().from("event_submissions").insert([{title:r,description:s,starts_at:o,ends_at:p,location_name:n,address:t.address??null,ticket_url:t.ticket_url??null,image_url:t.image_url??null,organizer_email:i,age:t.age??null,city:t.city??null,all_day:c,category:m,youtube_url:t.youtube_url??null,spotify_url:t.spotify_url??null,is_free:t.is_free??!1,status:"pending"}]);if(d)return a.NextResponse.json({error:d.message},{status:500});return a.NextResponse.json({ok:!0})}catch(e){return a.NextResponse.json({error:e?.message??"unknown error"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/submit-event/route",pathname:"/api/submit-event",filename:"route",bundlePath:"app/api/submit-event/route"},resolvedPagePath:"/workspaces/lisbon-events/app/api/submit-event/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:S,staticGenerationAsyncStorage:E,serverHooks:g}=d,f="/api/submit-event/route";function v(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:E})}},474:(e,t,r)=>{r.d(t,{R:()=>n});var s=r(1657);function n(){let e=process.env.NEXT_PUBLIC_SUPABASE_URL||process.env.SUPABASE_URL||"",t=process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.SUPABASE_SERVICE_KEY||process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"";if(!e||!t)throw Error("Supabase URL or KEY missing. Set NEXT_PUBLIC_SUPABASE_URL and either SUPABASE_SERVICE_ROLE_KEY or NEXT_PUBLIC_SUPABASE_ANON_KEY.");return(0,s.eI)(e,t,{auth:{persistSession:!1}})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,561,70],()=>r(2544));module.exports=s})();