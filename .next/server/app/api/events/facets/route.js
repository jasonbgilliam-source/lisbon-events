"use strict";(()=>{var e={};e.id=479,e.ids=[479],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3292:e=>{e.exports=require("fs/promises")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1017:e=>{e.exports=require("path")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},4978:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>_,requestAsyncStorage:()=>m,routeModule:()=>E,serverHooks:()=>S,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{GET:()=>f,dynamic:()=>l,revalidate:()=>d});var o=r(9303),n=r(8716),i=r(3131),a=r(474),p=r(3292),u=r(1017),c=r.n(u);let l="force-dynamic",d=0;async function f(){try{let e=(0,a.R)(),{data:t,error:r}=await e.from("category_catalog").select("name").order("name");if(r)throw Error(r.message);let s=(t||[]).map(e=>e.name),o=new Set,{data:n,error:i}=await e.from("events").select("city");if(i)throw Error(i.message);for(let e of n||[])e?.city&&o.add(String(e.city));try{let e=c().join(process.cwd(),"public","events.csv"),t=await (0,p.readFile)(e,"utf8"),r=function(e){let t=[],r=0,s="",o=[],n=!1;for(;r<e.length;){let i=e[r];if(n){if('"'===i){if('"'===e[r+1]){s+='"',r+=2;continue}n=!1,r++;continue}s+=i,r++;continue}if('"'===i){n=!0,r++;continue}if(","===i){o.push(s),s="",r++;continue}if("\r"===i){r++;continue}if("\n"===i){o.push(s),t.push(o),o=[],s="",r++;continue}s+=i,r++}return o.push(s),t.push(o),t.filter(e=>e.some(e=>""!==e))}(t),s=(r[0]?.map(e=>e.trim().toLowerCase())??[]).indexOf("city");for(let e=1;e<r.length;e++){let t=(r[e]?.[s]||"").trim();t&&o.add(t)}}catch{}let u=Array.from(o).sort((e,t)=>e.localeCompare(t));return new Response(JSON.stringify({categories:s,cities:u}),{headers:{"Content-Type":"application/json","Cache-Control":"no-store"}})}catch(e){return new Response(JSON.stringify({error:e?.message||"failed"}),{status:500,headers:{"Content-Type":"application/json"}})}}let E=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/events/facets/route",pathname:"/api/events/facets",filename:"route",bundlePath:"app/api/events/facets/route"},resolvedPagePath:"/workspaces/lisbon-events/app/api/events/facets/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:S}=E,v="/api/events/facets/route";function _(){return(0,i.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:h})}},474:(e,t,r)=>{r.d(t,{R:()=>o});var s=r(1657);function o(){let e=process.env.NEXT_PUBLIC_SUPABASE_URL||process.env.SUPABASE_URL||"",t=process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.SUPABASE_SERVICE_KEY||process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"";if(!e||!t)throw Error("Supabase URL or KEY missing. Set NEXT_PUBLIC_SUPABASE_URL and either SUPABASE_SERVICE_ROLE_KEY or NEXT_PUBLIC_SUPABASE_ANON_KEY.");return(0,s.eI)(e,t,{auth:{persistSession:!1}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,561],()=>r(4978));module.exports=s})();