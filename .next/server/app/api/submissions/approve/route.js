"use strict";(()=>{var e={};e.id=849,e.ids=[849],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},8507:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>S,patchFetch:()=>v,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{POST:()=>_,dynamic:()=>p});var a=r(9303),n=r(8716),i=r(3131),o=r(7070),u=r(474);function l(e){if(!e)return null;let t=new Date(e);return Number.isNaN(t.getTime())?null:t.toISOString()}let p="force-dynamic";async function _(e){try{let{id:t,reviewer:r,notes:s}=await e.json();if(!t)return o.NextResponse.json({error:"Missing id"},{status:400});let a=(0,u.R)(),{data:n,error:i}=await a.from("event_submissions").select("*").eq("id",t).limit(1);if(i)return o.NextResponse.json({error:i.message},{status:500});let p=n?.[0];if(!p)return o.NextResponse.json({error:"Submission not found"},{status:404});let _=function(e){var t;let r=e.title??e.name??e.event_title??"(untitled)",s=l(e.starts_at??e.start??e.start_time??e.start_datetime)??new Date().toISOString(),a=l(e.ends_at??e.end??e.end_time??e.end_datetime)??null;return{title:r,starts_at:s,ends_at:a,all_day:"boolean"==typeof(t=e.all_day??e.is_all_day??!1)?t:null!=t&&"true"===String(t).trim().toLowerCase(),location_name:e.location_name??e.venue??e.location??null,city:e.city??null,address:e.address??null,age:e.age??null,category:e.category??e.type??null,description:e.description??e.details??null,organizer_email:e.organizer_email??e.organizer??null,ticket_url:e.ticket_url??e.source_url??e.url??null,image_url:e.image_url??null,youtube_url:e.youtube_url??null,spotify_url:e.spotify_url??null}}(p),{error:d}=await a.from("events").insert([{title:_.title,description:_.description,starts_at:_.starts_at,ends_at:_.ends_at,category:_.category,location_name:_.location_name,city:_.city,address:_.address,ticket_url:_.ticket_url,image_url:_.image_url,all_day:_.all_day,age:_.age,organizer_email:_.organizer_email,youtube_url:_.youtube_url,spotify_url:_.spotify_url}]);if(d)return o.NextResponse.json({error:d.message},{status:500});let{error:c}=await a.from("event_submissions").update({status:"approved",reviewer:r,review_notes:s??null,approved_at:new Date().toISOString()}).eq("id",t);if(c)return o.NextResponse.json({error:c.message},{status:500});return o.NextResponse.json({ok:!0})}catch(e){return o.NextResponse.json({error:e?.message??"failed"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/submissions/approve/route",pathname:"/api/submissions/approve",filename:"route",bundlePath:"app/api/submissions/approve/route"},resolvedPagePath:"/workspaces/lisbon-events/app/api/submissions/approve/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:g}=d,S="/api/submissions/approve/route";function v(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},474:(e,t,r)=>{r.d(t,{R:()=>a});var s=r(1657);function a(){let e=process.env.NEXT_PUBLIC_SUPABASE_URL||process.env.SUPABASE_URL||"",t=process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.SUPABASE_SERVICE_KEY||process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"";if(!e||!t)throw Error("Supabase URL or KEY missing. Set NEXT_PUBLIC_SUPABASE_URL and either SUPABASE_SERVICE_ROLE_KEY or NEXT_PUBLIC_SUPABASE_ANON_KEY.");return(0,s.eI)(e,t,{auth:{persistSession:!1}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,561,70],()=>r(8507));module.exports=s})();